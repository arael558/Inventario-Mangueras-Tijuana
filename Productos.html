<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos | StockPro ✨</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --glow-primary: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 30%, var(--gray-50) 100%);
            color: var(--gray-900);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }

        .dashboard { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 300px;
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            display: flex;
            flex-direction: column;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--gray-100);
        }

        .logo-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: white;
            box-shadow: var(--shadow-lg);
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-nav {
            flex: 1;
        }

        .sidebar-nav ul {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 16px;
            color: var(--gray-600);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .sidebar-nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            opacity: 0;
            transition: opacity 0.2s ease;
            border-radius: 16px;
        }

        .sidebar-nav a:hover,
        .sidebar-nav .active a {
            color: var(--white);
            transform: translateX(8px) scale(1.02);
            box-shadow: var(--shadow-lg), var(--glow-primary);
        }

        .sidebar-nav a:hover::before,
        .sidebar-nav .active a::before {
            opacity: 1;
        }

        .sidebar-nav i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
            z-index: 1;
            position: relative;
        }

        .sidebar-nav span {
            z-index: 1;
            position: relative;
        }

        .logout-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--gray-100);
        }

        .logout-btn {
            color: var(--danger) !important;
            background: rgba(239, 68, 68, 0.05) !important;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            background: var(--gray-50);
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            background: var(--white);
            padding: 1.5rem 2rem;
            border-radius: 24px;
            box-shadow: var(--shadow-md);
        }

        .search-container {
            position: relative;
            width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 16px;
            outline: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-600);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-700);
        }

        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }

        .page-title {
            margin-bottom: 2rem;
        }

        .page-title h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .page-title p {
            color: var(--gray-600);
            font-size: 1.1rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .stat-icon.blue { background: linear-gradient(135deg, var(--primary), var(--secondary)); }
        .stat-icon.orange { background: linear-gradient(135deg, var(--warning), #f97316); }
        .stat-icon.green { background: linear-gradient(135deg, var(--success), #34d399); }

        .stat-info .stat-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .stat-info .stat-value {
            font-size: 1.875rem;
            font-weight: 800;
            color: var(--gray-900);
        }

        /* Controls Section */
        .controls-section {
            background: var(--white);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .controls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .controls-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .product-search {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-product {
            flex: 1;
            min-width: 250px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .search-product:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            gap: 0.5rem;
            align-items: center;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md), var(--glow-primary);
        }

        .btn-outline {
            background: var(--white);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }

        .btn-outline:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .format-hint {
            color: var(--gray-500);
            font-size: 0.85rem;
            margin-top: 1rem;
        }

        /* Table Section */
        .table-section {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .table-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--gray-50);
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .table-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .page-size-label {
            color: var(--gray-600);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .page-size {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            background: var(--white);
            font-size: 0.85rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            color: var(--gray-700);
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--gray-200);
        }

        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-100);
            color: var(--gray-700);
        }

        tbody tr:hover {
            background: var(--gray-50);
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-en-stock {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-stock-bajo {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-sin-stock {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            align-items: center;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--gray-500);
            background: var(--gray-100);
        }

        .action-btn:hover {
            transform: scale(1.1);
            color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
        }

        .rows-info {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .pager-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        .pager-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-200);
            background: var(--white);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .pager-btn:hover:not(:disabled) {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .pager-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-indicator {
            color: var(--gray-600);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--gray-100);
        }

        .logo-image {
            max-width: 280px;
            max-height: 200px;
            object-fit: contain;
            margin-top: -30px;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -300px;
                transition: left 0.3s ease;
                z-index: 100;
            }
            .sidebar.active { left: 0; }
            .main-content { padding: 1rem; }
            .header { flex-direction: column; gap: 1rem; }
            .search-container { width: 100%; }
            .stats-grid { grid-template-columns: 1fr; }
            .product-search { flex-direction: column; }
            .search-product { min-width: auto; }
            th, td { padding: 0.75rem 1rem; }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <aside class="sidebar" id="sidebar">
        <div class="logo">
            <img src="Logo.png" alt="Logo" class="logo-image">
        </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="dashboard.html"><i class="fas fa-home"></i><span>Dashboard</span></a>
                    </li>
                    <li class="active">
                        <a href="productos.html"><i class="fas fa-box"></i><span>Productos</span></a>
                    </li>
                    <li>
                        <a href="entradas.html"><i class="fas fa-arrow-down"></i><span>Entradas</span></a>
                    </li>
                    <li>
                        <a href="salidas.html"><i class="fas fa-arrow-up"></i><span>Salidas</span></a>
                    </li>
                    <li>
                        <a href="reportes.html"><i class="fas fa-chart-line"></i><span>Reportes</span></a>
                    </li>
                    <li>
                        <a href="proveedores.html"><i class="fas fa-users"></i><span>Proveedores</span></a>
                    </li>
                </ul>
            </nav>

            <div class="logout-section">
                <a href="#" class="logout-btn" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.5rem; border-radius: 16px; text-decoration: none;">
                    <i class="fas fa-sign-out-alt"></i><span>Cerrar Sesión</span>
                </a>
            </div>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Buscar productos, SKU o categoría...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                <div class="user-profile">
                    <span class="user-name">Carlos Vizcaín</span>
                    <div class="user-avatar">CV</div>
                </div>
            </header>

            <div class="page-title">
                <h1>Productos</h1>
                <p>Gestiona tu inventario y controla existencias, costos y valor total</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon blue">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Productos Totales</div>
                        <div class="stat-value" id="totalProducts">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon orange">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Stock Bajo</div>
                        <div class="stat-value" id="lowStock">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon green">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-label">Valor Total</div>
                        <div class="stat-value" id="totalValue">$0.00</div>
                    </div>
                </div>
            </div>

            <!-- Controls Section -->
            <div class="controls-section">
                <div class="controls-header">
                    <h2 class="controls-title">Gestión de Productos</h2>
                </div>
                
                <div class="product-search">
                    <input id="productSearch" class="search-product" type="text" placeholder="🔍 Buscar por código o descripción..." />
                    <button id="btnImport" class="btn btn-outline">
                        <i class="fas fa-file-upload"></i> Importar CSV
                    </button>
                    <input id="csvInput" type="file" accept=".csv" style="display:none" />
                    <button id="btnTemplate" class="btn btn-outline">
                        <i class="fas fa-download"></i> Plantilla
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i> Agregar Producto
                    </button>
                </div>
                
                <div class="format-hint">
                    <strong>Formato recomendado CSV:</strong> Código, Descripción, Stock Actual, Costo Unitario (Opcional: Valor Inventario)
                </div>
            </div>

            <!-- Table Section -->
            <div class="table-section">
                <div class="table-header">
                    <h2 class="table-title">Inventario de Productos</h2>
                    <div class="table-controls">
                        <label class="page-size-label" for="pageSize">Mostrar:</label>
                        <select id="pageSize" class="page-size">
                            <option>25</option>
                            <option selected>50</option>
                            <option>100</option>
                            <option>200</option>
                        </select>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Descripción</th>
                            <th>Stock Actual</th>
                            <th>Costo Unitario</th>
                            <th>Valor Inventario</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="productsTable"></tbody>
                </table>
                
                <div class="pagination">
                    <div class="rows-info" id="rowsInfo">0 filas</div>
                    <div class="pager-controls">
                        <button id="prevBtn" class="pager-btn">
                            <i class="fas fa-chevron-left"></i> Anterior
                        </button>
                        <span class="page-indicator" id="pageLabel">1 / 1</span>
                        <button id="nextBtn" class="pager-btn">
                            Siguiente <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        // State
        let products = [];      // full dataset
        let filtered = [];      // filtered dataset
        let currentPage = 1;
        let pageSize = 50;

        const $ = (sel) => document.querySelector(sel);

        function parseNumber(x) {
            if (x === undefined || x === null) return 0;
            if (typeof x === 'number') return x;
            const s = String(x).replace(/\$/g,'').replace(/,/g,'').trim();
            const n = parseFloat(s);
            return isNaN(n) ? 0 : n;
        }

        function formatMoney(n) {
            return n.toLocaleString('es-MX', { style: 'currency', currency: 'MXN', maximumFractionDigits: 2 });
        }

        function normalizeRow(row) {
            const code = row['Código'] ?? row['Cod. Producto'] ?? row['Cod Producto'] ?? row['code'] ?? row['codigo'] ?? row['Cod'] ?? '';
            const description = row['Descripción'] ?? row['Descripcion'] ?? row['description'] ?? '';
            const stockStr = row['Stock Actual'] ?? row['Stock'] ?? row['Cantidad Actual'] ?? row['Cantidad'] ?? row['Existencia'] ?? 0;
            const unitStr = row['Costo Unitario'] ?? row['Costo'] ?? row['Precio Unitario'] ?? 0;
            const valueStr = row['Valor Inventario'] ?? row['Costo Inventario'] ?? row['Valor'] ?? 0;
            let stock = parseNumber(stockStr);
            let unitCost = parseNumber(unitStr);
            let value = parseNumber(valueStr);
            if (!value) value = (stock * unitCost);
            if (!unitCost && stock) unitCost = value / stock;
            return { code: String(code).trim(), description: String(description).trim(), stock, unitCost };
        }

        function computeStatus(stock) {
            if (stock <= 0) return { text: 'Sin stock', class: 'status-sin-stock' };
            if (stock < 5) return { text: 'Stock bajo', class: 'status-stock-bajo' };
            return { text: 'En stock', class: 'status-en-stock' };
        }

        function render() {
            // filter
            const term = ($('#productSearch')?.value || '').toLowerCase();
            filtered = !term ? [...products] :
                products.filter(p => p.code.toLowerCase().includes(term) || p.description.toLowerCase().includes(term));

            // pagination
            const total = filtered.length;
            const totalPages = Math.max(1, Math.ceil(total / pageSize));
            if (currentPage > totalPages) currentPage = totalPages;
            const start = (currentPage - 1) * pageSize;
            const end = Math.min(start + pageSize, total);
            const pageRows = filtered.slice(start, end);

            const tbody = $('#productsTable');
            tbody.innerHTML = '';
            pageRows.forEach(p => {
                const value = p.stock * p.unitCost;
                const status = computeStatus(p.stock);
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><strong>${p.code}</strong></td>
                    <td>${p.description}</td>
                    <td>${p.stock.toLocaleString()}</td>
                    <td>${formatMoney(p.unitCost)}</td>
                    <td>${formatMoney(value)}</td>
                    <td><span class="status-badge ${status.class}">${status.text}</span></td>
                    <td>
                        <div class="action-buttons">
                            <div class="action-btn" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </div>
                            <div class="action-btn" title="Editar producto">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="action-btn" title="Eliminar producto">
                                <i class="fas fa-trash"></i>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // Update stats (global)
            const globalLowStock = products.filter(p => p.stock > 0 && p.stock < 5).length;
            const globalValue = products.reduce((acc, p) => acc + p.stock * p.unitCost, 0);

            $('#totalProducts').textContent = products.length.toLocaleString();
            $('#lowStock').textContent = globalLowStock.toLocaleString();
            $('#totalValue').textContent = formatMoney(globalValue);

            // pager UI
            $('#rowsInfo').textContent = total ? `Mostrando ${start+1}-${end} de ${total.toLocaleString()}` : '0 filas';
            $('#pageLabel').textContent = `${currentPage} / ${totalPages}`;
            $('#prevBtn').disabled = currentPage <= 1;
            $('#nextBtn').disabled = currentPage >= totalPages;
        }

        function loadCSVFile(file) {
            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                    try {
                        const rows = results.data;
                        const mapped = rows.map(normalizeRow).filter(r => r.code && r.description);
                        products = mapped;
                        currentPage = 1;
                        render();
                        alert(`✅ Se importaron ${mapped.length} productos correctamente`);
                    } catch (e) {
                        alert('❌ Error al procesar el CSV: ' + e.message);
                    }
                },
                error: (err) => alert('❌ No se pudo leer el CSV: ' + err)
            });
        }

        function downloadTemplate() {
            const csv = 'Código,Descripción,Stock Actual,Costo Unitario\n41FS-04,Adaptadores Latón SERIE FLARE 45,11,39.50\n41FS-05,Adaptadores Latón SERIE FLARE 45,7,49.00\n41FS-06,Adaptadores Latón SERIE FLARE 45,26,67.70\n';
            const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; 
            a.download = 'plantilla_productos_stockpro.csv'; 
            a.click();
            URL.revokeObjectURL(url);
        }

        // Demo data para mostrar contenido inicial
        products = [
            { code: "41FS-04", description: "Adaptadores Latón SERIE FLARE 45°", stock: 11, unitCost: 39.50 },
            { code: "41FS-05", description: "Adaptadores Latón SERIE FLARE 45°", stock: 7, unitCost: 49.00 },
            { code: "41FS-06", description: "Adaptadores Latón SERIE FLARE 45°", stock: 26, unitCost: 67.70 },
            { code: "41FS-08", description: "Adaptadores Latón SERIE FLARE 45°", stock: 4, unitCost: 102.00 },
            { code: "41FS-10", description: "Adaptadores Latón SERIE FLARE 45°", stock: 16, unitCost: 170.00 },
            { code: "41FS-12", description: "Adaptadores Latón SERIE FLARE 45°", stock: 9, unitCost: 290.00 },
            { code: "42FS-04", description: "Adaptadores Latón SERIE FLARE 90°", stock: 8, unitCost: 45.00 },
            { code: "42FS-06", description: "Adaptadores Latón SERIE FLARE 90°", stock: 15, unitCost: 72.50 },
            { code: "43FS-08", description: "Conectores Hidráulicos Premium", stock: 0, unitCost: 125.00 },
            { code: "44FS-10", description: "Válvulas de Control Industrial", stock: 3, unitCost: 350.00 }
        ];

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            render();
            
            $('#productSearch').addEventListener('input', () => { 
                currentPage = 1; 
                render(); 
            });
            
            $('#prevBtn').addEventListener('click', () => { 
                if (currentPage > 1) { 
                    currentPage--; 
                    render(); 
                } 
            });
            
            $('#nextBtn').addEventListener('click', () => { 
                currentPage++; 
                render(); 
            });
            
            $('#pageSize').addEventListener('change', (e) => { 
                pageSize = parseInt(e.target.value, 10) || 50; 
                currentPage = 1; 
                render(); 
            });
            
            $('#btnImport').addEventListener('click', () => $('#csvInput').click());
            
            $('#csvInput').addEventListener('change', (e) => {
                const f = e.target.files?.[0];
                if (f) loadCSVFile(f);
                e.target.value = '';
            });
            
            $('#btnTemplate').addEventListener('click', downloadTemplate);
        });

        // Search functionality for header
        document.querySelector('.search-input').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm) {
                $('#productSearch').value = searchTerm;
                currentPage = 1;
                render();
            }
        });

        // Mobile menu functionality
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // Add mobile menu button for small screens
        if (window.innerWidth <= 768) {
            const mobileBtn = document.createElement('button');
            mobileBtn.innerHTML = '<i class="fas fa-bars"></i>';
            mobileBtn.style.cssText = `
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 200;
                width: 48px;
                height: 48px;
                background: white;
                border: 2px solid var(--gray-200);
                border-radius: 12px;
                cursor: pointer;
                box-shadow: var(--shadow-md);
                color: var(--gray-700);
                font-size: 1.1rem;
            `;
            mobileBtn.onclick = toggleSidebar;
            document.body.appendChild(mobileBtn);
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                const sidebar = document.getElementById('sidebar');
                const isClickInsideSidebar = sidebar.contains(e.target);
                const isClickOnMenuBtn = e.target.closest('button') && e.target.closest('button').onclick === toggleSidebar;
                
                if (!isClickInsideSidebar && !isClickOnMenuBtn && sidebar.classList.contains('active')) {
                    sidebar.classList.remove('active');
                }
            }
        });
    </script>
</body>
</html>